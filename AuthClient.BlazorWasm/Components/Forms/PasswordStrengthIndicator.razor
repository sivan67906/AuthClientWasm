@namespace AuthClient.BlazorWasm.Components

<div class="password-strength-indicator">
    <div class="strength-bar">
        <div class="strength-bar-fill @GetStrengthClass()" style="width: @GetStrengthPercentage()%"></div>
    </div>
    <div class="strength-text @GetStrengthClass()">
        @GetStrengthText()
    </div>
    <ul class="requirements-list">
        <li class="@(HasMinLength() ? "valid" : "invalid")">
            <span class="oi @(HasMinLength() ? "oi-check" : "oi-x")"></span>
            At least 8 characters
        </li>
        <li class="@(HasUppercase() ? "valid" : "invalid")">
            <span class="oi @(HasUppercase() ? "oi-check" : "oi-x")"></span>
            One uppercase letter
        </li>
        <li class="@(HasLowercase() ? "valid" : "invalid")">
            <span class="oi @(HasLowercase() ? "oi-check" : "oi-x")"></span>
            One lowercase letter
        </li>
        <li class="@(HasNumber() ? "valid" : "invalid")">
            <span class="oi @(HasNumber() ? "oi-check" : "oi-x")"></span>
            One number
        </li>
        <li class="@(HasSpecialChar() ? "valid" : "invalid")">
            <span class="oi @(HasSpecialChar() ? "oi-check" : "oi-x")"></span>
            One special character
        </li>
    </ul>
</div>

@code {
    [Parameter]
    public string? Password { get; set; }

    private int CalculateStrength()
    {
        if (string.IsNullOrEmpty(Password))
            return 0;

        var strength = 0;

        if (HasMinLength()) strength += 20;
        if (HasUppercase()) strength += 20;
        if (HasLowercase()) strength += 20;
        if (HasNumber()) strength += 20;
        if (HasSpecialChar()) strength += 20;

        return strength;
    }

    private bool HasMinLength() => !string.IsNullOrEmpty(Password) && Password.Length >= 8;
    private bool HasUppercase() => !string.IsNullOrEmpty(Password) && Password.Any(char.IsUpper);
    private bool HasLowercase() => !string.IsNullOrEmpty(Password) && Password.Any(char.IsLower);
    private bool HasNumber() => !string.IsNullOrEmpty(Password) && Password.Any(char.IsDigit);
    private bool HasSpecialChar() => !string.IsNullOrEmpty(Password) && Password.Any(c => !char.IsLetterOrDigit(c));

    private string GetStrengthClass()
    {
        var strength = CalculateStrength();
        return strength switch
        {
            >= 100 => "strength-strong",
            >= 60 => "strength-good",
            >= 40 => "strength-fair",
            > 0 => "strength-weak",
            _ => "strength-none"
        };
    }

    private int GetStrengthPercentage() => CalculateStrength();

    private string GetStrengthText()
    {
        var strength = CalculateStrength();
        return strength switch
        {
            >= 100 => "Strong password",
            >= 60 => "Good password",
            >= 40 => "Fair password",
            > 0 => "Weak password",
            _ => "Very weak password"
        };
    }
}

<style>
    .password-strength-indicator {
        margin-top: 0.5rem;
    }

    .strength-bar {
        height: 4px;
        background-color: #e0e0e0;
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    .strength-bar-fill {
        height: 100%;
        transition: width 0.3s ease, background-color 0.3s ease;
        border-radius: 2px;
    }

    .strength-text {
        font-size: 0.875rem;
        font-weight: 500;
        margin-bottom: 0.75rem;
    }

    .strength-none .strength-bar-fill {
        background-color: #dc3545;
    }

    .strength-weak {
        color: #dc3545;
    }

    .strength-weak .strength-bar-fill {
        background-color: #dc3545;
    }

    .strength-fair {
        color: #ffc107;
    }

    .strength-fair .strength-bar-fill {
        background-color: #ffc107;
    }

    .strength-good {
        color: #17a2b8;
    }

    .strength-good .strength-bar-fill {
        background-color: #17a2b8;
    }

    .strength-strong {
        color: #28a745;
    }

    .strength-strong .strength-bar-fill {
        background-color: #28a745;
    }

    .requirements-list {
        list-style: none;
        padding: 0;
        margin: 0;
        font-size: 0.8125rem;
    }

    .requirements-list li {
        padding: 0.25rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: color 0.2s ease;
    }

    .requirements-list li.valid {
        color: #28a745;
    }

    .requirements-list li.invalid {
        color: #6c757d;
    }

    .requirements-list li .oi {
        font-size: 0.75rem;
    }
</style>
